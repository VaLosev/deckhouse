# Администрирование

## Термины и определения

тут список терминов и определений админского админа
| Термины и определения | Описание|
|:--- |:---|
| Термин | Описание термина |

 ## Доступ

### *Подключение*

Платформа Deckhouse предоставляет разнообразные методы подключения, позволяющие взаимодействовать с её API и web-интерфейсами.
Основной метод - публикация API вместе с веб-интерфейсами через HTTPS-балансировщик, который рекомендуется использовать по умолчанию. Дополнительно существует опция публикации API напрямую в корпоративной сети при условии [интеграции платформы для публикации сервисов](ссылку на раздел интеграции)) и возможность подключения по OpenVPN.
Эти возможности обеспечивают простое и надежное подключение пользователей, учитывая особенности сетевой инфраструктуры и требования по безопасности конкретной компании.

   * Установка
   * Настройка
   * Подключение узлов
   * Kubernetes Dashboard? (https://deckhouse.ru.test.flant.com/documentation/v1/modules/500-dashboard/)
   
   Сценарии установки через консоль и UI

### *Аутентификация*

Единая система аутентификации обеспечивает вам безопасный доступ ко всем веб-интерфейсом. 

Чтобы взаимодействовать с API:

1. сгенерируйте персональный файл конфигурации через специальный веб-интерфейс самообслуживания (kubeconfig-generator) и используйте с CLI и другими
инструментами (werf, helm, Lens и др.).

Платформа предлагает гибкость в управлении учетными записями:
* интеграция со внешними системами (OID, LDAP, Github, Github);
* использование внутреннего каталога пользователей.

Для автоматизированных задач:

1.Настройте аутентификацию через служебные учетные записи с JWT ключом (service account).

Также доступны временные пользователи с [ограниченным временем доступа](ссылка на раздел Авторизации --> Ограничение доступа), обеспечивающие гибкость и безопасность при необходимости временного доступа.

https://deckhouse.ru.test.flant.com/documentation/v1/modules/150-user-authn/

   * **Создание пользователя и пользовательская аутентификация**
   (Проверка подлинности пользователей и предоставление им доступа к ресурсам. Обычно это включает создание и управление пользователями, ролями и авторизациями в кластере с использованием стандартных механизмов аутентификации, таких как LDAP, OAuth, SAML или x509 сертификаты).
   * **Авторизация ресурсов**
   Предоставление пользователям прав на доступ к ресурсам в кластере - подам, сервисам через RBAC и вебхук.
   * **Шифрование**
   Шифрование секретов: пароли, токены и ключи API. Всякие Public Key Infrastructure.
   * **Контроль доступа RBAC**
   Управление доступом к ресурсам на основе предопределенных ролей, назначаемых пользователям.
   * **Конфигурации модуля аутентификации**
   * **Аутентификация на основе токенов**

(Способ аутентификации запросов API заключается в использовании *bearer* заголовка, содержащего действительный токен JWT для учетной записи службы. 
Как и в случае с пользователями, разные учетные записи служб будут иметь разные уровни доступа. 
Учетная запись службы имеет токен.Этот токен хранится как Secret и может быть прочитан как `secret`. Этот токен необходимо использовать для аутентификации стороннего приложения на сервере API.

Примерный сценарий **Аутентификация на основе токенов**:

1. Cоздайте учетную запись службы ДКП с именем *serviceaccount*.

2. Определите разрешение на аутентификацию для всего кластера (например, для get, list, watch pods, services, namespaces, deployments, jobs) с помощью *CluserRole*. *ClusterRole* будет присвоено имя учетной записи службы через *ClusterRoleBinding*. Токен внутри учетной записи службы может использоваться для аутентификации/авторизации сервера API. 
Можно вызывать API-интерфейсы сервера DropApp API с помощью этого токена (с *bearer* заголовком) и получить доступ к ресурсам (например, pods, services, namespaces и т.д.).)
   
### *Авторизация*

https://deckhouse.ru.test.flant.com/documentation/v1/modules/140-user-authz/

   * **Роли и права доступа**
   * **Ограничения доступа**

ДКП - это API-first система, где управление на 100% происходит через API (сценарий управления API). 

Управление уровнем доступа к проектам происходит также на уровне API, а все последующие интерфейсы, такие как CLI и web, функционируют в соответствии с этими правами доступа (сценарии соответствующие описать).

Чиобы настроить права доступа к проектам, основанные либо на стандартном RBAC Kubernetes, либо на предустановленных ролях (User, Privileged User, Editor, Admin):

1.
1.
1.
Все это обеспечивает гибкость в определении, как администраторы будут видеть и взаимодействовать с проектами на платформе - начиная от простого просмотра и до выполнения сложных операций.

## Подготовка окружения 

(https://deckhouse.ru/gs/gcp/step3.html)
Из быстростарт

## Установка и сопровождение

### *Установка платформы*

  https://deckhouse.ru.test.flant.com/documentation/v1/installing/

  https://deckhouse.ru/documentation/v1/modules/030-cloud-provider-gcp/environment.html

  GCP, Яндекс провайдер... специфика каждого провайдера

   
   * **Подготовка инфраструктуры**
   * **Подготовка конфигурации**
   * **Ресурсы установки**
   * **Установка ДКП**

### *Интеграция платформы с инфраструктурой*(отсутствует контент)

Интеграция платформы Deckhouse с инфраструктурой может включать несколько этапов:

* Подключение к Deckhouse. Для этого необходимо создать новый кластер и подключить его к контроллеру Deckhouse.
* Настройка ресурсов. После подключения кластера необходимо настроить ресурсы  Deployments, Services и Ingresses.
* Создание и управление приложениями. С помощью Deckhouse можно создавать и управлять приложениями, такими как микросервисы, на платформе Kubernetes.

Оин из сценариев сюда (https://deckhouse.ru.test.flant.com/documentation/v1/modules/402-ingress-nginx/)

   * **Настройка взаимодействия между компонентами платформы и существующими системами**
   * **Разработка механизмов обмена данными между платформой и другими системами**
   * **Обеспечение совместимости платформы с различными типами оборудования и программного обеспечения**
   * **Создание инструментов для импорта данных из других источников и экспорта данных в другие системы**
   * **Интеграция с системами управления доступом и авторизацией пользователей**
   * **Настройка интеграции с внешними сервисами и API**

### *Настройка платформы*

https://deckhouse.ru.test.flant.com/documentation/v1/installing/configuration.html

* Установка платформы (ссылка на раздел установки)
Сценарий - загрузить образ платформы и развернуть на серверах.
* Настройка инфраструктуры
Сценарий - настроить инфраструктуру (серверы, сети, пользователи и другие ресурсы).
* Настройка контроллера репликации?
* Управление доступом и авторизация (ссылка на рздел создания пользователей, RBAC)
* Интеграция с другими системами (ссылка на раздел, где системы управления версиями, системы мониторинга и т.д.)
* Мониторинг (ссылка на раздел мониторинга)

### *Обновление платформы*

* **Окна и каналы обновлений**

https://deckhouse.ru.test.flant.com/guides/production.html#канал-и-режим-обновлений

https://deckhouse.ru.test.flant.com/documentation/v1/deckhouse-release-channels.html

Deckhouse предоставляет целый спектр возможностей управления запуском обновлений:

1. Сценарии: Автоматический запуск при поступлении обновления в канал (early-access, stable, Its), включая такие инструменты как «окна обновлений», до полностью контролируемого режима, где обновления утверждаются вручную.

Сам процесс обновления осуществляется полностью автоматически, включая как инфраструктурные компоненты и ПО на узлах, так и всю высокоуровневую функциональность (платформа Kubernetes, аутентификация, мониторинг, журналирование, управление сертификатами, балансировка трафика, безопасность, виртуализация и др.).

Deckhouse обеспечивает стабильность работы платформы и приложений при обновлениях, при условии соблюдения последними рекомендаций отказаустойчевости: наличие более чем одной реплики и указания максимального количества недоступных реплик (PDB).
Для обеспечения обратной совместимости Deckhouse применяет трёхкомпонентный подход: сохранение обратной совместимости между версиями, правила устаревания (deprecation policy) и автоматическую блокировку запуска обновлений при возникновении проблем.
Всегда поддерживается не менее 4 версий Kubernetes. Платформа поддерживает обновления в изолированных средах и при помощи твердых носителей, Все эти возможности гарантируют предсказуемость обновления, обеспечивая баланс между свежестью и стабильностью.

### *Высокая надежность и доступность*

https://deckhouse.ru.test.flant.com/guides/production.html#особенности-конфигурации

https://deckhouse.ru.test.flant.com/guides/production.html

https://deckhouse.ru.test.flant.com/documentation/v1/kubernetes.html

https://deckhouse.ru.test.flant.com/documentation/latest/modules/040-node-manager/cr.html#nodegroup-v1-spec-chaos-period

https://deckhouse.ru.test.flant.com/documentation/v1/modules/460-log-shipper/

* **Going to production** 

https://deckhouse.ru.test.flant.com/guides/production.html

- Подготовка инфраструктуры
Например, создание необходимых серверов, сетей, пользователей...
- Развертывание ДКП
Образ Deckhouse или собственный образ для развертывания платформы на пользовательской инфраструктуре.
- Настройка ДКП
Изменение конфигурации, добавление новых компонентов и т. д.
- Тестирование и отладка

### *Управление ресурсами платформы*

https://deckhouse.ru.test.flant.com/guides/production.html#требования-к-ресурсам

https://deckhouse.ru.test.flant.com/documentation/v1/installing/# (хранилища)

  * Управление вычислительными ресурсами: Можно создавать новые ресурсы, изменять их параметры и удалять ненужные.
  * Управление хранилищами данных: Deckhouse предоставляет инструменты для работы с различными типами хранилищ, такими как локальные диски, облачные хранилища и базы данных. Можно создавать новые хранилища, монтировать их к контейнерам и управлять доступом к ним.
  * Управление сетевыми ресурсами: настраивать сетевые интерфейсы, правила межсетевого экранирования и виртуальные частные сети (VPN). Также доступ к различным сервисам и приложениям в сети.
  * Мониторинг ресурсов: о встроенных инструментах для мониторинга ресурсов - нагрузка на процессор, использование памяти и сетевого трафика + можно отслеживать состояние системы и фиксить возможные проблемы.

### *Масштабирование платформы*

https://deckhouse.ru.test.flant.com/documentation/v1/modules/001-priority-class/configuration.html#

Все значимые компоненты масштабируются горизонтально, что обеспечивает высокий потенциал масштабирования платформы Deckhouse: гарантируется возможность расширения кластера платформы до 1,000 серверов и 50,000 pod'ов. 
В том числе горизонтально масштабируются ядро платформы и инфраструктурно-агностический слой (за исключением control plane), сетевая подсистема (SDN), интеграция с СХД и балансировщики и маршрутизаторы трафика.
Вертикальное масштабирование применяется только к control-plane, супер-оператору, и платформе мониторинга, при этом для двух последних планируется перейти на горизонтально-масштабируемый вариант.
Масштабирование вычислительных мощностей обеспечивает удобное и независимое управление каждой группой узлов, с автоматическим масштабированием как в облачных так и статических кластерах (последнее в разработке).
Также предусмотрены инструменты для планирования мощностей.
На практике, платформа позволяет добиться почти бесконечного масштабирования через создание дополнительных кластеров (сценарий).

### *Безопасность платформы*

https://deckhouse.ru.test.flant.com/documentation/v1/modules/160-multitenancy-manager/
https://deckhouse.ru.test.flant.com/documentation/v1/modules/015-admission-policy-engine/


Deckhouse предоставляет продуманные механизмы безопасности, обеспечивающие защиту всех компонентов платформы и контроль доступа администраторов. Образы, манифесты и конфигурация компонентов платформы создаются таким образом, чтобы изначально быть безопасными. Сборка происходит из проверенных исходных кодов, и все образы проходят сканирование на уязвимости во время сборки.
В процессе работы действуют политики запрещающие небезопасные возможности для контейнеров платформы. Дополнительно может быть включено проведение непрерывной проверки безопасности:
* периодическое сканирование образов контейнеров всех компонентов платформы на наличие уязвимостей; 
* постоянный аудит выполнения действий процессов на узлах кластера и обращений к API Deckhouse.

Связь между компонентами осуществляется только посредством TLS/HTTPS с обеспечением аутентификации и авторизации, а также настроенными сетевыми политиками (последнее в разработке).
Доступ извне к компонентам платформы обеспечивается только через TLS/HTTPS с единой аутентификацией и авторизацией.

Важным аспектом безопасности является возможность проведение аудита обращений к API, позволяющего контролировать все операции в кластере. Все эти действия приводят к тому, что платформа обладает высоким уровнем безопасности и соответствует стандартам безопасности CIS A Benchmark и PCI SSC (а в будущей редакции CSE - будет обладать сертификатомСТЭК)-Windows, перейдите в раздел "Параметры".

Также в безопасность:
  * изоляция контейнеров;
  * выявление уязвимостей в образах контейнеров;
  * проверка корректности конфигурации контейнеров;
  * контроль целостности контейнеров и их образов;
  * регистрация событий безопасности.

* **Дока по портам**

https://deckhouse.ru.test.flant.com/documentation/v1/search.html?query=порты

(сценариев нет)

* Порт Kubernetes API: порт для коммуникации между компонентами Kubernetes - 6443.
* HTTPS-порт:  HTTPS для шифрования трафика между компонентами, обычно 443 или любой другой, указанный в конфигурации.
* DNS-порт: для службы DNS в Kubernetes - 53.
* Prometheus-порт: порт 9090 для приема запросов.
* Grafana-порт: порт 3000.
* Трафик etcd: информация о состоянии кластера хранится в etcd, для которого требуется порт 2379 или 2380 (в зависимости от протокола).
* Трафик портов метрик: сбор метрик с различных компонентов Kubernetes через порт 8429.


* **Дока по папкам для антивируса**

По антивирусам сценариев нет (нужно включить все российские).



### *Мониторинг платформы*

https://deckhouse.ru.test.flant.com/guides/production.html#уведомление-о-событиях-мониторинга

https://deckhouse.ru.test.flant.com/documentation/v1/modules/300-prometheus/ (и все разделы ниже)

  * **Системы мониторинга - Prometheus & Grafana**
  * **Мониторинг пользовательского приложения**
  * **Мониторинг сети**
  * **Мониторинг кластера**
  * **Мониторинг control plane**
  * **Расширенный мониторинг**

### *Журналирование платформы*

https://deckhouse.ru.test.flant.com/guides/production.html#сбор-логов

https://deckhouse.ru.test.flant.com/guides/production.html#резервное-копирование

https://deckhouse.ru.test.flant.com/documentation/v1/modules/460-log-shipper/#

  * **Логи** - сбор, хранение и анализ лог-файлов 

## Контроль и управление доступом

### *Разделение ресурсов платформы между пользователями*

Безопасность и конфиденциальность данных для каждого пользователя?

https://deckhouse.ru.test.flant.com/documentation/v1/search.html?query=пользователи (покопаться тут можно)


## Пожелания коллег к доке админа: 

Товарищи, всем привет в данном чате! я ознакомился со всем тредом, но пока не очень понимаю, в каком виде мы тут хотим иметь доку (и где мы хотим её видеть)Как понимаю, было бы неплохо иметь как минимум описания мест, где у нас прописываются данные о реджистри (источник истины как понимаю, это секрет d8-system/deckhouse-registry , также данные у нас прописываются в /etc/containerd/config.toml, который синкается из /etc/containerd/deckhouse.toml)Но как будто бы у нас сейчас где-либо в документации таких мест нет, и вообще это подходит вероятно для "руководства администратора", который планируется у нас в будущем?

From a thread in tech-deckhouse | Yesterday at 6:44 PM | View reply

dmitrii.kovalkov

Да, я понимаю, просто команда helm -n d8-system get manifest deckhouse даёт уже отрендеренные (с подставленными значениями), а в секрете именно темплейт
