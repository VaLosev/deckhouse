## Описание в таблице: https://deckhouse.ru/scheme/

Платформа Deckhouse предоставляет разнообразные методы подключения, позволяющие взаимодействовать с её API и web-интерфейсами.
Основной метод - публикация API вместе с веб-интерфейсами через HTTPS-балансировщик, который рекомендуется использовать по умолчанию. Дополнительно существует опция публикации API напрямую в корпоративной сети при условии [интеграции платформы для публикации сервисов](ссылку на раздел интеграции)) и возможность подключения по OpenVPN.
Эти возможности обеспечивают простое и надежное подключение пользователей, учитывая особенности сетевой инфраструктуры и требования по безопасности конкретной компании.

   * Установка
   * Настройка
   * Подключение узлов
   * Kubernetes Dashboard? (https://deckhouse.ru.test.flant.com/documentation/v1/modules/500-dashboard/)
   
   (Сюда-же добавить сценарии установки через консоль и UI)

## Список фич в гугл-файле: https://docs.google.com/spreadsheets/d/1n7sPRng-V4uWQS-36159No57B1kSF1gU6EWwXcOJSls/edit#gid=205229375

## Сценарии подключения пользователей

1. Создание учетных записей пользователей. 

Создайте пользователей с соответствующими ролями и правами на доступ к кластеру.

2. Создание объекта пользователя в Kubernetes API.

`kubectl`, например, или другой инструмент управления, создайте файл с расширением .yaml, описывающий пользователя и его роли.

3. Публикация объекта пользователя.

Например, используя `kubctl apply`, опубликуйте созданный объект пользователя в кластере.

4. Загрузка файла ролей и учетных записей пользователей в сервер аутентификации (например, Keycloak, Dex, или OpenID Connect).

Пользователи должны пройти аутентификацию и авторизацию с помощью сервера аутентификации.
После успешной аутентификации и авторизации, пользователь получает токен, который можно использовать для подключения к Kubernetes API.
Пользователь использует `kubectl` или другое приложение для подключения к кластеру с использованием токена.


## Публикация API через HTTPS-балансировщик

1. Установка и настройка Deckhouse.

Необходимо установить и настроить Deckhouse....

Идет сценарий установки

2. Создание и настройка балансировщика

 Создайте и настройте балансировщик HTTPS на стороне Deckhouse.
 
3. Подключение к балансировщику.

На стороне пользователя, подключитесь к балансировщику через Интернет или корпоративную сеть.

## Публикация API напрямую в корпоративной сети

1. Интеграция платформы для публикации сервисов.

2. Настройка сети с API Deckhouse. (Получается тут надо описать настройку брандмауэра и других сетевых устройств).

3. Подключение по OpenVPN.


## Черновые варианты сценариев

### Файл kubeconfig

По умолчанию инструмент командной строки для управления кластерами `kubectl` задействуется через командную строку (например, через bash) и использует контексты для взаимодействия с кластером. Контекст - это набор параметров доступа, содержащий кластер, пользователя и пространство имен. Контексты используются для доступа к определенному кластеру и пространству имен с помощью учетной записи пользователя. 
Установка того, с каким кластером взаимодействует ДКП и изменение конфигурационной информации осуществляются посредством `kubectl`.

### Control plane

Компоненты управляющего слоя, которые отвечают за основные операции кластера ДКП (например, планирование), а также обрабатывают события кластера ДКП (например, запускают новый pod, когда поле развертывания `replicas` не соответствует требуемому количеству реплик).
Минимальный набор таких компонентов: `etcd`, `API-server`, `controller manager`.
Помимо управляющих компонентов, в ДКП входят `kubelet` и `kubeproxy`, которые запущены на всех узлах кластера ДКП. Компоненты Control plane могут быть запущены на любой машине в кластере. Однако сценарии настройки обычно запускают все компоненты управляющего слоя на одном компьютере и в то же время не позволяют запускать пользовательские контейнеры на этом компьютере.

### API-server

Центральный компонент кластера ДКП. Он является связывающим компонентом для всех остальных сервисов. Все взаимодействие как самих компонентов, так и обращение извне к кластеру проходит через kube-apiserver и проверяется им. 

<!--Уточнить-->

Это единственный компонент кластера ДКП, который общается с базой данных `etcd`, где хранится состояние кластера ДКП.
В самом API Server нет бизнес-логики. API Server не принимает решения, например, за то, на каком узле запустить тот или иной сервис.
В нем существует логика проверки формата запросов, аутентификации, проверки прав и т.д.
Еще одной функцией API Server является рассылка изменений конфигураций и состояния кластера ДКП.
Другие компоненты подписываются на события, отслеживают их и обрабатывают, либо с определенной периодичностью считывают конфигурацию через API Server.

### Etcd

Высоконадежное распределенное хранилище данных. ДКП хранит в нем информацию о состоянии существующих кластеров ДКП, сервисах, сети и т. д.
Доступ к данным осуществляется через `REST API`. При изменениях записей вместо поиска и изменения предыдущей копии, все предыдущие записи помечаются как устаревшие, а новые значения записываются в конец. Позже устаревшие значения удаляются специальным процессом. В небольших временных кластерах `etcd` можно запускать в единственном экземпляре и на одном узле с ведущими компонентами.
В важных системах, требующих избыточности и высокой доступности, `etcd` следует создавать в виде кластера ДКП, состоящего из нескольких узлов.
Сервер API является основной точкой управления всего кластера ДКП. Он обрабатывает операции REST, проверяет их и обновляет соответствующие объекты в `etcd`. Сервер API обслуживает ДКП API и задуман как простой сервер, с большей частью бизнес-логики, реализованной в отдельных компонентах или в плагинах. Ниже приведены некоторые примеры API, доступных на сервере API.





