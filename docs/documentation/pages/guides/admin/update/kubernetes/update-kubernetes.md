---
title: Изменение версии Kubernetes в Deckhouse Kubernetes Platform
permalink: ru/update/kubernetes/update-kubernetes/
lang: ru
---

* автоматическое обновление kubelet, control plane и Kubernetes: Automatic --> release, fixed - fixed.
depricated --> can't update cluster

Чтобы изменить версию Kubernetes:

1. Выполните команду:

   ```
   kubectl -n d8-system exec -ti deploy/deckhouse --deckhouse-controller edit cluster-configuration
   ```

1. Измените параметр `kubernetesVersion`, выбрав `kubernetesVersion: Automatic` или указав желаемую версию.

  список поддерживаемых версий Kubernetes можно найти в [документации](../../supported_versions.html#kubernetes).
1. Сохраните изменения. 

    Узлы кластера внутри каждой группы узлов начнут последовательно обновляться. Группы узлов обновляются паралелльно.  
    Если указанная для обновления версия Kubernetes в параметре `kubernetesVersion` не соответствует текущей версии управляющего слоя (control plane) в кластере, Deckhouse Kubernetes Platform (DKP) для поддержания работы кластера начнет также обновлять компоненты:
      - **при переходе к новой версии** обновление происходит последовательными этапами, по одной минорной версии, например от 1.22 к 1.23, от 1.23 к 1.24, от 1.24 к 1.25. На каждом этапе сначала обновляется версия управляющего слоя, затем происходит обновление `kubelet` на узлах кластера.
      - **при переходе к старой версии** успех гарантируется только на одну версию вниз от максимальной минорной версии управляющего слоя, когда-либо использовавшейся в кластере:
        - происходит понижение версии `kubelet` на узлах кластера.
        - происходит понижение версии компонентов управляющего слоя.

    Текущая версия Kubernetes в кластере определяется по версиям управляющего слоя и узлов кластера.
1. Отслеживайте ход обновления с помощью команды `kubectl get no`.  
    Когда в выводе команды у каждого узла кластера в колонке `VERSION` появится нужная версия, обновление можно считать завершенны.

> Обновление `control plane` выполняется безопасно и для single-master, и для multi-master-кластеров. Во время обновления может быть кратковременная недоступность API-сервера. На работу приложений в кластере обновление не влияет и может выполняться без выделения окна для регламентных работ.

## Гарантия стабильности при обновлениях

Модули обеспечивают механизмы обновления без простоя:
* Модуль `control-plane-manager` следит, чтобы обновление компонентов управляющего слоя выполнялось по очереди на каждом мастер-узле: для этого реализован алгоритм запроса и выдачи разрешения на обновление через специальный [диспетчер](ссылка).
* Модуль `node-manager` отвечает за управление узлами, в том числе и за обновление `kubelet`.

  Каждый узел в кластере принадлежит к одной из групп узлов. Как только `node-manager` определяет, что версия управляющего слоя на всех узлах обновилась, то он приступает к обновлению версии `kubelet`. Если обновление узла не приводит к простою, оно считается безопасным и выполняется в автоматическом режиме. В данном случае обновление `kubelet` больше не приводит к перезапуску контейнеров.

* В рамках `node-manager` реализован механизм автоматической выдачи разрешений на обновление узла, что гарантирует одновременное обновление только одного узла в рамках группы узлов. При этом обновление узлов в группе узлов выполняется, когда нет узлов в процессе заказа. Это касается только облачных кластеров, где есть автоматический заказ новых виртуальных машин.
